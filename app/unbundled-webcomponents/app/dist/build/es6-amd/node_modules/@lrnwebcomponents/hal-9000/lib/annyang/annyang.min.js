//! annyang
//! version : 2.6.1
//! author  : Tal Ater @TalAter
//! license : MIT
//! https://www.TalAter.com/annyang/
!function(root,factory){"function"==typeof define&&define.amd?define([],(function(){return root.annyang=factory(root)})):"object"==typeof module&&module.exports?module.exports=factory(root):root.annyang=factory(root)}("undefined"!=typeof window?window:this,(function(root,undefined){var annyang,SpeechRecognition=root.SpeechRecognition||root.webkitSpeechRecognition||root.mozSpeechRecognition||root.msSpeechRecognition||root.oSpeechRecognition;if(!SpeechRecognition)return null;var recognition,autoRestart,commandsList=[],callbacks={start:[],error:[],end:[],soundstart:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},lastStartedAt=0,autoRestartCount=0,debugState=!1,debugStyle="font-weight: bold; color: #00f;",pauseListening=!1,isListening=!1,optionalParam=/\s*\((.*?)\)\s*/g,optionalRegex=/(\(\?:[^)]+\))\?/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#]/g,invokeCallbacks=function(callbacks,...args){callbacks.forEach((function(callback){callback.callback.apply(callback.context,args)}))},isInitialized=function(){return recognition!==undefined},logMessage=function(text,extraParameters){-1!==text.indexOf("%c")||extraParameters?console.log(text,extraParameters||debugStyle):console.log(text)},initIfNeeded=function(){isInitialized()||annyang.init({},!1)},registerCommand=function(command,callback,originalPhrase){commandsList.push({command:command,callback:callback,originalPhrase:originalPhrase}),debugState&&logMessage("Command successfully loaded: %c"+originalPhrase,debugStyle)},parseResults=function(results){var commandText;invokeCallbacks(callbacks.result,results);for(let i=0;i<results.length;i++){commandText=results[i].trim(),debugState&&logMessage("Speech recognized: %c"+commandText,debugStyle);for(let j=0,l=commandsList.length;j<l;j++){var currentCommand=commandsList[j],result=currentCommand.command.exec(commandText);if(result){var parameters=result.slice(1);return 0==parameters.length&&(parameters=result),debugState&&(logMessage("command matched: %c"+currentCommand.originalPhrase,debugStyle),parameters.length&&logMessage("with parameters",parameters)),currentCommand.callback.apply(this,parameters),void invokeCallbacks(callbacks.resultMatch,commandText,currentCommand.originalPhrase,results)}}}invokeCallbacks(callbacks.resultNoMatch,results)};return annyang={init:function(commands,resetCommands=!0){recognition&&recognition.abort&&recognition.abort(),(recognition=new SpeechRecognition).maxAlternatives=5,recognition.continuous="http:"===root.location.protocol,recognition.lang="en-US",recognition.onstart=function(){isListening=!0,invokeCallbacks(callbacks.start)},recognition.onsoundstart=function(){invokeCallbacks(callbacks.soundstart)},recognition.onerror=function(event){switch(invokeCallbacks(callbacks.error,event),event.error){case"network":invokeCallbacks(callbacks.errorNetwork,event);break;case"not-allowed":case"service-not-allowed":autoRestart=!1,(new Date).getTime()-lastStartedAt<200?invokeCallbacks(callbacks.errorPermissionBlocked,event):invokeCallbacks(callbacks.errorPermissionDenied,event)}},recognition.onend=function(){if(isListening=!1,invokeCallbacks(callbacks.end),autoRestart){var timeSinceLastStart=(new Date).getTime()-lastStartedAt;(autoRestartCount+=1)%10==0&&debugState&&logMessage("Speech Recognition is repeatedly stopping and starting. See http://is.gd/annyang_restarts for tips."),timeSinceLastStart<1e3?setTimeout((function(){annyang.start({paused:pauseListening})}),1e3-timeSinceLastStart):annyang.start({paused:pauseListening})}},recognition.onresult=function(event){if(pauseListening)return debugState&&logMessage("Speech heard, but annyang is paused"),!1;var SpeechRecognitionResult=event.results[event.resultIndex],results=[];for(let k=0;k<SpeechRecognitionResult.length;k++)results[k]=SpeechRecognitionResult[k].transcript;parseResults(results)},resetCommands&&(commandsList=[]),commands.length&&this.addCommands(commands)},start:function(options){initIfNeeded(),pauseListening=(options=options||{}).paused!==undefined&&!!options.paused,autoRestart=options.autoRestart===undefined||!!options.autoRestart,options.continuous!==undefined&&(recognition.continuous=!!options.continuous),lastStartedAt=(new Date).getTime();try{recognition.start()}catch(e){debugState&&logMessage(e.message)}},abort:function(){autoRestart=!1,autoRestartCount=0,isInitialized()&&recognition.abort()},pause:function(){pauseListening=!0},resume:function(){annyang.start()},debug:function(newState=!0){debugState=!!newState},setLanguage:function(language){initIfNeeded(),recognition.lang=language},addCommands:function(commands){var cb,command;initIfNeeded();for(let phrase in commands)if(commands.hasOwnProperty(phrase))if("function"==typeof(cb=root[commands[phrase]]||commands[phrase]))registerCommand((command=(command=phrase).replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,(function(match,optional){return optional?match:"([^\\s]+)"})).replace(splatParam,"(.*?)").replace(optionalRegex,"\\s*$1?\\s*"),new RegExp("^"+command+"$","i")),cb,phrase);else{if(!("object"==typeof cb&&cb.regexp instanceof RegExp)){debugState&&logMessage("Can not register command: %c"+phrase,debugStyle);continue}registerCommand(new RegExp(cb.regexp.source,"i"),cb.callback,phrase)}},removeCommands:function(commandsToRemove){commandsToRemove===undefined?commandsList=[]:(commandsToRemove=Array.isArray(commandsToRemove)?commandsToRemove:[commandsToRemove],commandsList=commandsList.filter(command=>{for(let i=0;i<commandsToRemove.length;i++)if(commandsToRemove[i]===command.originalPhrase)return!1;return!0}))},addCallback:function(type,callback,context){var cb=root[callback]||callback;"function"==typeof cb&&callbacks[type]!==undefined&&callbacks[type].push({callback:cb,context:context||this})},removeCallback:function(type,callback){var compareWithCallbackParameter=function(cb){return cb.callback!==callback};for(let callbackType in callbacks)callbacks.hasOwnProperty(callbackType)&&(type!==undefined&&type!==callbackType||(callbacks[callbackType]=callback===undefined?[]:callbacks[callbackType].filter(compareWithCallbackParameter)))},isListening:function(){return isListening&&!pauseListening},getSpeechRecognizer:function(){return recognition},trigger:function(sentences){annyang.isListening()?(Array.isArray(sentences)||(sentences=[sentences]),parseResults(sentences)):debugState&&logMessage(isListening?"Speech heard, but annyang is paused":"Cannot trigger while annyang is aborted")}}}));