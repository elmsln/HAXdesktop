define(["exports"],(function(_exports){function camelToDash(str){return str.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()}function dashToCamel(str){return str.replace(/-([a-z])/g,(function(g){return g[1].toUpperCase()}))}function varExists(obj,path){return"__failedToFind__"!=objectValFromStringPos(obj,path,"__failedToFind__")}function varGet(obj,path,fallback=""){return objectValFromStringPos(obj,path,fallback)}function objectValFromStringPos(o,s,r=null){for(var a=(s=(s=s.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),i=0,n=a.length;i<n;++i){var k=a[i];if(!o)return r;if(!(k in o))return r;o=o[k]}return o}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.normalizeEventPath=function normalizeEventPath(e){return e.composed&&e.composedPath?e.composedPath():e.path?e.path:e.originalTarget?[e.originalTarget]:[e.target]},_exports.wrap=function wrap(el,wrapper){el&&el.parentNode&&(el.parentNode.insertBefore(wrapper,el),wrapper.appendChild(el))},_exports.unwrap=function unwrap(el){if(el&&el.parentNode){for(;el.firstChild;)el.parentNode.insertBefore(el.firstChild,el);el.remove()}},_exports.formatHTML=function formatHTML(str){var div=document.createElement("div");return div.innerHTML=str.trim(),function formatHTMLInternals(node,level){let textNode,indentBefore=new Array(1+level++).join("  "),indentAfter=new Array(level-1).join("  ");for(var i=0;i<node.children.length;i++)textNode=document.createTextNode("\n"+indentBefore),node.insertBefore(textNode,node.children[i]),formatHTMLInternals(node.children[i],level),node.lastElementChild==node.children[i]&&(textNode=document.createTextNode("\n"+indentAfter),node.appendChild(textNode));return node}(div,0).innerHTML},_exports.validURL=function validURL(str){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(str)},_exports.valueMapTransform=function valueMapTransform(items,map){let tmpAry=[];map&&items.forEach(item=>{let tmp={};for(var key in map){let value=map[key];if(!0===value||!1===value||null===value)tmp[key]=value;else if("function"==typeof value)try{tmp[key]=value(item)}catch(e){console.warn(e)}else"string"==typeof value&&varExists(item,value)?tmp[key]=varGet(item,value):tmp[key]=value}tmpAry.push(tmp)});return tmpAry},_exports.haxElementToNode=function haxElementToNode(haxSchema){let tag=haxSchema.tag,content=haxSchema.content?haxSchema.content:"",properties=haxSchema.properties?haxSchema.properties:{};window.HaxStore&&window.HaxStore.instance&&window.HaxStore.instance._isSandboxed&&"iframe"===tag&&(tag="webview");var frag=document.createElement(tag);frag.innerHTML=content;var newNode=frag.cloneNode(!0);for(var property in properties){let attributeName=camelToDash(property);properties.hasOwnProperty(property)&&(!0===properties[property]?newNode.setAttribute(attributeName,properties[property]):!1===properties[property]?newNode.removeAttribute(attributeName):null!=properties[property]&&properties[property].constructor===Array?frag.properties&&frag.properties[property]&&frag.properties[property].readOnly||(newNode.set?newNode.set(attributeName,properties[property]):newNode[attributeName]=[...properties[property]]):null!=properties[property]&&properties[property].constructor===Object?frag.properties&&frag.properties[property]&&frag.properties[property].readOnly||(newNode.set?newNode.set(attributeName,properties[property]):newNode[attributeName]={...properties[property]}):newNode.setAttribute(attributeName,properties[property]))}return newNode},_exports.dashToCamel=dashToCamel,_exports.camelToDash=camelToDash,_exports.camelCaseToDash=function camelCaseToDash(key){return key.replace(/([A-Z])/g,g=>`-${g[0].toLowerCase()}`)},_exports.encapScript=function encapScript(html){html&&"function"==typeof html.replace&&(html=(html=(html=(html=(html=(html=(html=(html=(html=html.replace(/<script[\s\S]*?>/gi,"&lt;script&gt;")).replace(/<\/script>/gi,"&lt;/script&gt;")).replace(/<hax[\s\S]*?>/gi,"")).replace(/<\/hax[\s\S]*?>/gi,"")).replace(/<h-a-x[\s\S]*?>/gi,"")).replace(/<\/h-a-x*?>/gi,"")).replace(/<style[\s\S]*?>/gi,"&lt;style&gt;")).replace(/<\/style>/gi,"&lt;/style&gt;")).replace(/<template[\s\S]*?>[\s\S]*?&lt;script[\s\S]*?&gt;[\s\S]*?&lt;\/script&gt;/gi,(function(match,contents,offset,input_string){return match=(match=(match=(match=match.replace("&lt;script&gt;","<script>")).replace("&lt;/script&gt;","<\/script>")).replace("&lt;style&gt;","<style>")).replace("&lt;/style&gt;","</style>")})));return html},_exports.findTagsInHTML=function findTagsInHTML(html){let tags={},tag="";var matches=html.match(/<\/([a-z,0-9]*?)-(\S*?)>/g);for(var i in matches)tag=matches[i].replace("</","").replace(">",""),tags[tag]=tag;return tags},_exports.wipeSlot=function wipeSlot(element,slot="*"){if("*"===slot)for(;null!==element.firstChild;)element.removeChild(element.firstChild);else for(var i in element.childNodes)void 0!==element.childNodes[i]&&element.childNodes[i].slot===slot&&element.removeChild(element.childNodes[i])},_exports.generateResourceID=function generateResourceID(base="#"){function idPart(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return base+idPart()+idPart()+"-"+idPart()+"-"+idPart()+"-"+idPart()+"-"+idPart()+idPart()+idPart()},_exports.stripMSWord=function stripMSWord(input){var output=input.split("\n\r").join("\n").split("\r").join("\n").split("\n\n").join("\n").split("\n\n").join("\n").split("\n\n").join("\n").split("\n").join(" ").replace(/( class=(")?Mso[a-zA-Z]+(")?)/g,"");output=(output=(output=output.replace(/<\!--(\s|.)*?-->/gim,"")).replace(/<\!(\s|.)*?>/gim,"")).replace(/<(\/)*(meta|link|html|head|body|span|font|br|\\\\?xml:|xml|st1:|o:|w:|m:|v:)(\s|.)*?>/gim,"");var badTags=["style","script","applet","embed","noframes","noscript"];for(var i in badTags){let tagStripper=new RegExp("<"+badTags[i]+"(s|.)*?"+badTags[i]+"(.*?)>","gim");output=output.replace(tagStripper,"")}for(var i in output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=(output=output.replace(/ style='(\s|.)*?'/gim,"")).replace(/ face="(\s|.)*?"/gim,"")).replace(/ align=.*? /g,"")).replace(/ start='.*?'/g,"")).replace(/ id="(\s|.)*?"/gim,"")).replace(/ dir="(\s|.)*?"/gim,"")).replace(/ role="(\s|.)*?"/gim,"")).replace(/ contenteditable="(\s|.)*?"/gim,"")).replace(/ data-(\s|.)*?"(\s|.)*?"/gim,"")).replace(/ class="(\s|.)*?"/gim,"")).replace(/&nbsp;/gm," ")).replace(/<section>/gm,"<p>")).replace(/<\/section>/gm,"</p>")).replace(/<p><p>/gm,"<p>")).replace(/<p><p>/gm,"<p>")).replace(/<\/p><\/p>/gm,"</p>")).replace(/<\/p><\/p>/gm,"</p>")).replace(/<br \/>/gm,"<br/>")).replace(/<p><br \/><b>/gm,"<p><b>")).replace(/<\/p><br \/><\/b>/gm,"</p></b>")).replace(/<b><p>/gm,"<p>")).replace(/<\/p><\/b>/gm,"</p>")).replace(/<li><p>/gm,"<li>")).replace(/<\/p><\/li>/gm,"</li>")).replace(/<b><ul>/gm,"<ul>")).replace(/<\/ul><\/b>/gm,"</ul>")).replace(/<b><ol>/gm,"<ol>")).replace(/<\/ol><\/b>/gm,"</ol>")).replace(/<span><p>/gm,"<p>")).replace(/<\/p><\/span>/gm,"</p>")).replace(/<p>(\s*)<\/p>/gm," ")).replace(/<p><\/p>/gm,"")).replace(/<p>&nbsp;<\/p>/gm," ")).replace(/<p><br\/><\/p>/gm,"")).replace(/<p><br><\/p>/gm,"")).replace(/<\/p>(\s*)<p>/gm,"</p><p>"),badTags){let emptyTagRemove=new RegExp("<"+badTags[i]+"></"+badTags[i]+">","gi");output=output.replace(emptyTagRemove,"")}return output=output.trim()},_exports.varExists=varExists,_exports.varGet=varGet,_exports.objectValFromStringPos=objectValFromStringPos,_exports.nodeToHaxElement=function nodeToHaxElement(node,eventName="insert-element"){if(!node)return null;var props={};void 0!==node.style&&(props.style=node.getAttribute("style"));null!==props.style&&"null"!==props.style||delete props.style;void 0!==node.attributes.class&&(props.class=node.attributes.class.value.replace("hax-active",""));void 0!==node.attributes.id&&(props.id=node.getAttribute("id"));let tmpProps;customElements.get(node.tagName.toLowerCase())&&(tmpProps=customElements.get(node.tagName.toLowerCase()).properties);void 0===tmpProps&&(tmpProps=node.__data);if(void 0!==tmpProps){for(var property in tmpProps)("class"!=property&&"style"!=property&&tmpProps.hasOwnProperty(property)&&void 0!==typeof node[property]&&null!=node[property]&&""!=node[property]||!1===node[property])&&(props[property]=node[property]);for(var attribute in node.attributes)void 0!==node.attributes[attribute].name&&"class"!=node.attributes[attribute].name&&"style"!=node.attributes[attribute].name&&"id"!=node.attributes[attribute].name&&node.attributes.hasOwnProperty(attribute)&&void 0!==typeof node.attributes[attribute].value&&null!=node.attributes[attribute].value&&""!=node.attributes[attribute].value&&!tmpProps.hasOwnProperty(dashToCamel(node.attributes[attribute].name))&&(props[dashToCamel(node.attributes[attribute].name)]=node.attributes[attribute].value)}else for(var attribute in node.attributes)void 0!==node.attributes[attribute].name&&"class"!=node.attributes[attribute].name&&"style"!=node.attributes[attribute].name&&"id"!=node.attributes[attribute].name&&node.attributes.hasOwnProperty(attribute)&&void 0!==typeof node.attributes[attribute].value&&null!=node.attributes[attribute].value&&""!=node.attributes[attribute].value&&(props[dashToCamel(node.attributes[attribute].name)]=node.attributes[attribute].value);let tag=node.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"iframe"===tag&&(tag="webview");let slotContent=window.HaxStore.instance.getHAXSlot(node);""==slotContent&&(slotContent=node.innerText);"a"===tag?props.innerText=slotContent:"p"!==tag&&"table"!==tag&&"ol"!==tag&&"ul"!==tag&&"div"!==tag||(props.innerHTML=slotContent);let element={tag:tag,properties:props,content:slotContent};null!==eventName&&(element.eventName=eventName);return element},_exports.getRange=function getRange(root){if(root.getSelection){const s=root.getSelection();return s.rangeCount?s.getRangeAt(0):null}const thisFrame=cachedRange.get(root);if(thisFrame)return thisFrame;const initialText=window.getSelection().toString(),result=internalGetShadowSelection(root),rs=result&&result.range&&result.range.toString()||null;null!==rs&&rs!==initialText&&rs.replace(/\s/g,"")!==initialText.replace(/\s/g,"")&&(console.warn("invalid range, initial text:",initialText),console.warn("vs",rs,result.mode,result.range));return cachedRange.set(root,result.range),window.setTimeout(()=>{cachedRange.delete(root)},0),result.range},_exports.internalGetShadowSelection=internalGetShadowSelection,_exports.ReplaceWithPolyfill=function ReplaceWithPolyfill(){var currentNode,parent=this.parentNode,i=arguments.length;if(!parent)return;i||parent.removeChild(this);for(;i--;)"object"!=typeof(currentNode=arguments[i])?currentNode=this.ownerDocument.createTextNode(currentNode):currentNode.parentNode&&currentNode.parentNode.removeChild(currentNode),i?parent.insertBefore(currentNode,this.nextSibling):parent.replaceChild(currentNode,this)},_exports.winEventsElement=void 0;_exports.winEventsElement=function(SuperClass){return class extends SuperClass{__applyWinEvents(status){if(this.__winEvents)for(var eName in this.__winEvents)window[`${status?"add":"remove"}EventListener`](eName,this[this.__winEvents[eName]].bind(this))}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this.__applyWinEvents(!0)}disconnectedCallback(){this.__applyWinEvents(!1),super.disconnectedCallback&&super.disconnectedCallback()}}};const validNodeTypes=[Node.ELEMENT_NODE,Node.TEXT_NODE,Node.DOCUMENT_FRAGMENT_NODE];function findNode(s,parentNode,isLeft){const nodes=parentNode.childNodes||parentNode.children;if(!nodes)return parentNode;for(let i=0;i<nodes.length;++i){const childNode=nodes[isLeft?i:nodes.length-1-i];if((node=childNode,validNodeTypes.includes(node.nodeType))&&s.containsNode(childNode,!0))return s.containsNode(childNode,!1)?childNode:findNode(s,childNode,isLeft)}var node;return parentNode}const addInternalListener=(()=>{if(document.createElement("div").attachShadow({mode:"open"}).getSelection)return document.addEventListener("selectionchange",ev=>{document.dispatchEvent(new CustomEvent("-shadow-selectionchange"))}),()=>{};let withinInternals=!1;const handlers=[];return document.addEventListener("selectionchange",ev=>{withinInternals||(document.dispatchEvent(new CustomEvent("-shadow-selectionchange")),withinInternals=!0,window.setTimeout(()=>{withinInternals=!1},0),handlers.forEach(fn=>fn(ev)))}),fn=>handlers.push(fn)})();let wasCaret=!1,resolveTask=null;function containsNextElement(s,node,walkForward){const start=node;for(;(node=walkFromNode(node,walkForward))&&node.contains(start););return!!node&&(node instanceof Element&&s.containsNode(node,!0))}function walkFromNode(node,walkForward){if(!walkForward)return node.previousSibling||node.parentNode||null;for(;node;){if(node.nextSibling)return node.nextSibling;node=node.parentNode}return null}function initialSpace(node){return node.nodeType!==Node.TEXT_NODE?0:/^\s*/.exec(node.textContent)[0].length}addInternalListener(ev=>{"Caret"===window.getSelection().type?wasCaret=!0:wasCaret&&!resolveTask&&(resolveTask=Promise.resolve(!0).then(()=>{wasCaret=!1,resolveTask=null}))});const cachedRange=new Map;const fakeSelectionNode=document.createTextNode("");function internalGetShadowSelection(root){const range=document.createRange(),s=window.getSelection();if(s&&root.host&&!s.containsNode(root.host,!0))return{range:null,mode:"none"};root.insertBefore(fakeSelectionNode,root.childNodes[0]);const includesBeforeRoot=s.containsNode(fakeSelectionNode);if(fakeSelectionNode.remove(),includesBeforeRoot)return{range:null,mode:"outside-before"};root.appendChild(fakeSelectionNode);const includesAfterRoot=s.containsNode(fakeSelectionNode);if(fakeSelectionNode.remove(),includesAfterRoot)return{range:null,mode:"outside-after"};const measure=()=>s.toString().length;s.toString();if("None"===s.type)return null;if("Caret"!==s.type&&"Range"!==s.type)throw new TypeError("unexpected type: "+s.type);s.type;const leftNode=findNode(s,root,!0);let rightNode,isNaturalDirection=void 0;if("Range"===s.type&&(rightNode=findNode(s,root,!1),isNaturalDirection=function getSelectionDirection(s,leftNode,rightNode){if("Range"!==s.type)return;const measure=()=>s.toString().length,initialSize=measure();if(1===initialSize&&wasCaret&&leftNode===rightNode)return s.extend(leftNode,0),void s.collapseToEnd();let updatedSize;return s.modify("extend","forward","character"),updatedSize=measure(),updatedSize>initialSize||containsNextElement(s,rightNode,!0)?(s.modify("extend","backward","character"),!0):updatedSize<initialSize||!s.containsNode(leftNode)?(s.modify("extend","backward","character"),!1):(s.modify("extend","backward","character"),updatedSize=measure(),updatedSize>initialSize||containsNextElement(s,leftNode,!1)?(s.modify("extend","forward","character"),!1):updatedSize<initialSize||!s.containsNode(rightNode)?(s.modify("extend","forward","character"),!0):void 0)}(s,leftNode,rightNode)),"Caret"===s.type){s.extend(leftNode,0);const at=measure();return s.collapseToEnd(),1===leftNode.nodeType&&leftNode.childNodes&&leftNode.childNodes.length>0?(range.setStart(leftNode.childNodes[0],at),range.setEnd(leftNode.childNodes[0],at)):(range.setStart(leftNode,at),range.setEnd(leftNode,at)),{range:range,mode:"caret"}}if(void 0===isNaturalDirection){if("Range"!==s.type)throw new TypeError("unexpected type: "+s.type);return range.setStart(leftNode.childNodes[0],0),range.setEnd(rightNode,rightNode.length),{range:range,mode:"all"}}const size=measure();let offsetLeft,offsetRight;const validRightLength=rightNode.length-function ignoredTrailingSpace(node){if(node.nodeType!==Node.TEXT_NODE)return 0;const trailingSpaceCount=/\s*$/.exec(node.textContent)[0].length;return trailingSpaceCount?trailingSpaceCount-1:0}(rightNode);return isNaturalDirection?(s.extend(leftNode,0),offsetLeft=measure()+initialSpace(leftNode),s.extend(rightNode,validRightLength),offsetRight=validRightLength-(measure()-size),s.extend(rightNode,offsetRight)):(s.extend(rightNode,validRightLength),offsetRight=validRightLength-measure(),s.extend(leftNode,0),offsetLeft=measure()-size+initialSpace(leftNode),s.extend(leftNode,offsetLeft)),range.setStart(leftNode,offsetLeft),range.setEnd(rightNode,offsetRight),{mode:isNaturalDirection?"right":"left",range:range}}}));