import{LitElement,html}from"../../../lit-element/lit-element.js";import{SimpleTourManager}from"../../simple-popover/lib/simple-tour.js";import{winEventsElement,getRange,stripMSWord,nodeToHaxElement,haxElementToNode,validURL,camelToDash}from"../../utils/utils.js";import{observable,makeObservable,computed,configure,autorun,toJS}from"../../../mobx/dist/mobx.esm.js";configure({enforceActions:!1,useProxies:"ifavailable"});import{HAXElement}from"../../hax-body-behaviors/hax-body-behaviors.js";class HaxStore extends(winEventsElement(HAXElement(LitElement))){testHook(el,op){return el&&"function"==typeof el.haxHooks&&el.haxHooks()[op]}runHook(el,op,data=[]){return!!this.testHook(el,op)&&el[el.haxHooks()[op]](...data)}getSelection(){if(this.activeHaxBody&&this.activeHaxBody.parentNode){if(this.activeHaxBody.parentNode.getSelection)return this.activeHaxBody.parentNode.getSelection();try{if(getRange(this.activeHaxBody.parentNode))return getRange(this.activeHaxBody.parentNode)}catch(e){}}return window.getSelection()}getRange(){let sel=this.getSelection();return sel.getRangeAt&&sel.rangeCount?sel.getRangeAt(0):sel||void 0}guessGizmo(guess,values,skipPropMatch=!1,preferExclusive=!1){var matches=[];if(void 0!==guess&&this.validGizmoTypes.includes(guess))for(var gizmoposition in this.gizmoList){let gizmo=this.gizmoList[gizmoposition],props={},match=!1;if(gizmo&&gizmo.handles)for(var i=0;i<gizmo.handles.length;i++)if(guess===gizmo.handles[i].type||"*"===guess&&!match){for(var property in gizmo.handles[i])"type"!==property&&void 0!==values[property]&&("inline"!==guess&&gizmo.meta&&(!gizmo.meta||gizmo.meta.inlineOnly||gizmo.meta.hidden)||(match=!0,props[gizmo.handles[i][property]]=values[property]));if(match||skipPropMatch){if(preferExclusive&&gizmo.handles[i].type_exclusive)return[this.haxElementPrototype(gizmo,props,"")];matches.push(this.haxElementPrototype(gizmo,props,""))}}}return matches}insertLogicFromValues(values,context,failOnAnything=!1){let type=this.guessGizmoType(values),typeName=type,preferExclusive=!0;if("*"==type){if(failOnAnything)return!1;preferExclusive=!1,typeName="link"}let haxElements=this.guessGizmo(type,values,!1,preferExclusive);return haxElements.length>0?(1===haxElements.length?void 0!==haxElements[0].tag&&context.dispatchEvent(new CustomEvent("hax-insert-content",{bubbles:!0,cancelable:!0,composed:!0,detail:haxElements[0]})):this.haxAppPicker.presentOptions(haxElements,type,"Pick how to present this "+typeName,"gizmo"),!0):(this.toast("Sorry, HAX doesn't know how to handle that type of link yet."),!1)}write(prop,value,obj){obj&&obj.dispatchEvent(new CustomEvent("hax-store-write",{composed:!0,bubbles:!0,cancelable:!1,detail:{property:prop,value,owner:obj}}))}mimeTypeToGizmoType(mime){let parts=mime.split("/");switch(parts[0]){case"audio":return"audio";case"image":return"svg+xml"==parts[1]?"svg":"image";case"video":return"video";case"text":return["csv","html","markdown"].includes(parts[1])?parts[1]:"document";case"application":return"pdf"==parts[1]?"pdf":["zip","gzip","x-tar"].includes(parts[1])?"archive":"document"}}guessGizmoType(guess){if(void 0!==guess.source){const source=guess.source.toLowerCase();if(-1!=source.indexOf(".mp3")||-1!=source.indexOf(".midi")||-1!=source.indexOf(".mid"))return"audio";if(-1!=source.indexOf(".png")||-1!=source.indexOf(".jpg")||-1!=source.indexOf(".jpeg")||-1!=source.indexOf(".gif"))return"image";if(-1!=source.indexOf(".pdf"))return"pdf";if(-1!=source.indexOf(".svg"))return"svg";if(-1!=source.indexOf(".csv"))return"csv";if(-1!=source.indexOf(".md"))return"markdown";if(-1!=source.indexOf(".html")||-1!=source.indexOf(".htm"))return"html";if(-1!=source.indexOf(".txt")||-1!=source.indexOf(".doc")||-1!=source.indexOf(".docx")||-1!=source.indexOf(".xls")||-1!=source.indexOf(".xlsx")||-1!=source.indexOf(".vtt")||-1!=source.indexOf(".ppt"))return"document";if(-1!=source.indexOf(".zip")||-1!=source.indexOf(".tar.gz")||-1!=source.indexOf(".tar"))return"archive";if("external"!=window.MediaBehaviors.Video.getVideoType(source))return"video"}return"*"}render(){return html` <slot></slot> `}static get tag(){return"hax-store"}toast(message,duration=2e3,classStyle="capsule",closeText=null,eventCallback=null){window.dispatchEvent(new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:message,duration,classStyle,closeText,eventCallback}}))}static get properties(){return{...super.properties,voiceDebug:{type:Boolean,attribute:"voice-debug"},voiceRespondsTo:{type:String,attribute:"voice-responses-to"},skipHAXConfirmation:{type:Boolean,reflect:!0,attribute:"skip-hax-confirmation"},storageData:{type:Object},haxTray:{type:Object},haxAutoloader:{type:Object},haxBodies:{type:Array},activePlaceHolder:{type:Object},appStore:{type:Object},sessionObject:{type:Object},skipExitTrap:{type:Boolean},elementList:{type:Object},staxList:{type:Array},validTagList:{type:Array},validGridTagList:{type:Array},validGizmoTypes:{type:Array},_isSandboxed:{type:Boolean},__appStoreData:{type:Object},ready:{type:Boolean},connectionRewrites:{type:Object}}}_storageDataChanged(newValue){newValue&&this.ready&&this.__storageDataProcessed&&(window.localStorage.getItem("haxConfirm")?window.localStorage.setItem("haxUserData",JSON.stringify(newValue)):window.sessionStorage.getItem("haxConfirm")&&window.sessionStorage.setItem("haxUserData",JSON.stringify(newValue)))}isTextElement(node){let tag;return null!=node&&node.tagName?tag=node.tagName.toLowerCase():null!=node&&node.tag&&(tag=node.tag.toLowerCase()),!!(tag&&this.validTagList.includes(tag)&&["p","ol","ul","li","a","h1","h2","h3","h4","h5","h6","strike","u","b","sub","sup","span","i","bold","em","strong","blockquote","code","figure"].includes(tag))}isGridPlateElement(node){let tag;return node&&node.tagName?tag=node.tagName.toLowerCase():node&&node.tag&&(tag=node.tag.toLowerCase()),!(!tag||!this.validGridTagList.includes(tag))}_appStoreChanged(newValue,oldValue){newValue&&oldValue&&(newValue.url&&!newValue.apps&&this.shadowRoot?this.loadAppStoreFromRemote():this.__appStoreData=newValue)}_loadAppStoreData(appDataResponse){if(null!=appDataResponse){var items={};if(void 0!==appDataResponse.autoloader)for(var i in appDataResponse.autoloader=Object.assign({},appDataResponse.autoloader),appDataResponse.autoloader){let CEname=i,CEimport=appDataResponse.autoloader[i];isNaN(CEname)||(CEname=appDataResponse.autoloader[i],CEimport=`@lrnwebcomponents/${CEname}/${CEname}.js`),this.validTagList.push(CEname),items[CEname]=CEimport}if(void 0!==appDataResponse.apps){var apps=appDataResponse.apps;for(i=0;i<apps.length;i++){let app=document.createElement("hax-app");app.data=apps[i],this.appendChild(app)}}if(void 0!==appDataResponse.stax){var staxs=appDataResponse.stax;for(i=0;i<staxs.length;i++){let stax=document.createElement("hax-stax");stax.data=staxs[i],this.appendChild(stax)}}this.dispatchEvent(new CustomEvent("hax-store-app-store-loaded",{bubbles:!0,cancelable:!0,composed:!0,detail:!0})),this._handleDynamicImports(items,this.haxAutoloader),this.__appStoreHasLoaded=!0}}pathFromUrl(url){return url.substring(0,url.lastIndexOf("/")+1)}async _handleDynamicImports(items,haxAutoloader){const basePath=this.pathFromUrl(decodeURIComponent(import.meta.url));for(var i in items)window.customElements.get(i)?window.customElements.get(i).haxProperties?this.setHaxProperties(window.customElements.get(i).haxProperties,i):haxAutoloader.appendChild(document.createElement(i)):await import(`${basePath}../../../${items[i]}`).then(response=>{window.customElements.get(i)&&window.customElements.get(i).haxProperties?this.setHaxProperties(window.customElements.get(i).haxProperties,i):haxAutoloader.appendChild(document.createElement(i))}).catch(error=>{console.warn(error),haxAutoloader.appendChild(document.createElement(i))})}_editModeChanged(newValue){this.__hal&&(newValue&&this.globalPreferences.haxVoiceCommands?this.__hal.auto=!0:this.__hal.auto=!1),newValue&&!this.__appStoreHasLoaded&&this.__appStoreData&&this.haxAutoloader&&(clearTimeout(this.__readyToProcessAppStoreData),this._loadAppStoreData(this.__appStoreData))}_globalPreferencesChanged(newValue){if(this.__storageDataProcessed&&newValue&&void 0!==newValue.haxVoiceCommands&&this.ready){let storageData=this.storageData;storageData.globalPreferences=newValue,this.storageData=storageData,this._storageDataChanged(this.storageData),newValue.haxVoiceCommands&&!this.__hal&&import("../../hal-9000/hal-9000.js").then(esModule=>{this._initVoiceCommands(),this.__hal=document.createElement("hal-9000"),this.__hal.respondsTo=this.voiceRespondsTo,this.__hal.debug=this.voiceDebug,this.__hal.auto=!0,this.shadowRoot.appendChild(this.__hal),this.__hal.commands={...this.voiceCommands}}),this.__hal&&(newValue.haxVoiceCommands&&this.editMode?this.__hal.auto=!0:this.__hal.auto=!1)}}_haxContextOperation(e){let detail=e.detail;if(this.activeNode){let changed=!1;switch(detail.eventName){case"hax-align-left":this.activeNode.style.float=null,this.activeNode.style.margin=null,this.activeNode.style.display=null,changed=!0;break;case"hax-align-center":this.activeNode.style.float=null,this.activeNode.style.margin="0 auto",this.activeNode.style.display="block",changed=!0;break;case"hax-align-right":this.activeNode.style.float="right",this.activeNode.style.margin="0 auto",this.activeNode.style.display="block",changed=!0;break;case"hax-size-change":100==detail.value?this.activeNode.style.width=null:this.activeNode.style.width=detail.value+"%",changed=!0}changed&&(clearTimeout(this.__repositionMenu),this.__repositionMenu=setTimeout(()=>{this.activeHaxBody.positionContextMenus()},0))}}_haxConsentTap(e){window.localStorage.setItem("haxConfirm",!0),window.localStorage.setItem("haxUserData",JSON.stringify(this.storageData))}updated(changedProperties){super.updated&&super.updated(changedProperties),changedProperties.forEach((oldValue,propName)=>{"appStore"==propName&&this[propName]&&this._appStoreChanged(this[propName],oldValue),["ready","__appStoreData","haxAutoloader"].includes(propName)&&this.ready&&this.__appStoreData&&this.haxAutoloader&&(clearTimeout(this.__readyToProcessAppStoreData),this.__readyToProcessAppStoreData=setTimeout(()=>{this._loadAppStoreData(this.__appStoreData)},0)),["haxAutoloader","activeHaxBody","haxTray"].includes(propName)&&(clearTimeout(this.__storeReady),this.__storeReady=setTimeout(()=>{this._storePiecesAllHere(this.haxAutoloader,this.activeHaxBody,this.haxTray,this.haxExport)},0))})}_calculateActiveGizmo(activeNode){if(null==activeNode||!activeNode.tagName)return null;for(var gizmoposition in this.gizmoList){var gizmo=this.gizmoList[gizmoposition];if(gizmo.tag===activeNode.tagName.toLowerCase())return gizmo}}loadAppStoreFromRemote(){const searchParams=new URLSearchParams(this.appStore.params);let url=this.appStore.url;searchParams&&(url+=`?${searchParams}`),fetch(url,{method:this.method}).then(response=>{if(response.ok)return response.json()}).then(json=>{this.__appStoreData=json})}firstUpdated(changedProperties){if(super.firstUpdated&&super.firstUpdated(changedProperties),this.skipHAXConfirmation&&(window.sessionStorage.setItem("haxConfirm",!0),window.localStorage.setItem("haxConfirm",!0)),window.sessionStorage.getItem("haxConfirm")||window.localStorage.getItem("haxConfirm"))if(window.sessionStorage.getItem("haxConfirm")&&!window.localStorage.getItem("haxConfirm"))try{let globalData=window.sessionStorage.getItem("haxUserData")?JSON.parse(window.sessionStorage.getItem("haxUserData")):{};this.storageData=globalData,this._storageDataChanged(this.storageData)}catch(e){}else try{let globalData=window.localStorage.getItem("haxUserData")?JSON.parse(window.localStorage.getItem("haxUserData")):{};this.storageData=globalData,this._storageDataChanged(this.storageData)}catch(e){}else{window.sessionStorage.setItem("haxConfirm",!0);let msg="\n    The HAX content editor keeps preferences in order to improve your experience.\n    This data is stored in your browser and is never sent anywhere.\n    Click to accept.\n    ";this.toast(msg,"-1","fit-bottom","I Accept","hax-consent-tap")}setTimeout(()=>{this.__storageDataProcessed=!0,this.storageData.globalPreferences&&this.write("globalPreferences",this.storageData.globalPreferences,this)},0)}_storePiecesAllHere(haxAutoloader,activeHaxBody,haxTray,haxExport){!this.ready&&activeHaxBody&&haxAutoloader&&haxTray&&haxExport&&(this.dispatchEvent(new CustomEvent("hax-store-ready",{bubbles:!0,cancelable:!1,composed:!0,detail:!0})),HAXStore.haxExport.shadowRoot.querySelector("#dialog").associateEvents(haxTray.shadowRoot.querySelector("#exportbtn")),this.ready=!0,this._buildPrimitiveDefinitions())}_initVoiceCommands(){this.__voiceInit=!0,this.voiceCommands[`scroll up ${this.voiceRespondsTo}`]=()=>{window.scrollBy({top:-.5*window.innerHeight,left:0,behavior:"smooth"})},this.voiceCommands[`scroll (down) ${this.voiceRespondsTo}`]=()=>{window.scrollBy({top:.5*window.innerHeight,left:0,behavior:"smooth"})},this.voiceCommands[`scroll to bottom ${this.voiceRespondsTo}`]=()=>{window.scrollTo(0,document.body.scrollHeight)},this.voiceCommands[`scroll to top ${this.voiceRespondsTo}`]=()=>{window.scrollTo(0,0)},this.voiceCommands[`${this.voiceRespondsTo} (show)(focus) active (element)(content)`]=()=>{try{this._positionCursorInNode(this.activeNode)}catch(e){}},this.voiceCommands[`${this.voiceRespondsTo} (focus) previous (element)(content)`]=()=>{this.activeNode.previousElementSibling?(this.activeNode=this.activeNode.previousElementSibling,this.write("activeNode",this.activeNode,this),this._positionCursorInNode(this.activeNode)):this.speak("You are at the top of the document")},this.voiceCommands[`${this.voiceRespondsTo} (focus) next (element)(content)`]=()=>{this.activeNode.nextElementSibling?(this.activeNode=this.activeNode.nextElementSibling,this.write("activeNode",this.activeNode,this),this._positionCursorInNode(this.activeNode)):this.speak("You are at the bottom of the document")},this.voiceCommands[`${this.voiceRespondsTo} type *mycontent`]=e=>{if(this.isTextElement(this.activeNode))try{let range=this._positionCursorInNode(this.activeNode),text=document.createTextNode(e);range.deleteContents(),range.insertNode(text)}catch(e){this.speak("That didn't work"),console.warn(e)}else this.speak("I'm sorry but I can only type in text areas. Try saying Insert Paragraph and try again.")},this.voiceCommands[`hey ${this.voiceRespondsTo}`]=()=>{this.speak("Yeah what do you want")},this.voiceCommands[`${this.voiceRespondsTo} now your name is *splat`]=text=>{const past=this.voiceRespondsTo;this.speak(`I used to be named ${past} but you can call me ${text} now.`),this.voiceRespondsTo=`(${text})`}}speak(text){this.__hal&&this.__hal.speak&&this.__hal.speak(text),this.toast(`${this.voiceRespondsTo}: ${text}`)}addVoiceCommand(command,context,callback){context&&(command=command.replace(":name:",this.voiceRespondsTo).toLowerCase(),this.voiceCommands[command]=context[callback].bind(context),this.__voiceInit&&(this.__hal.commands={...this.voiceCommands}))}_addVoiceCommand(e){let target=e.detail.context;target||(target=e.target),this.addVoiceCommand(e.detail.command,target,e.detail.callback)}_positionCursorInNode(node,position=0){this.activeHaxBody.positionContextMenus();var range=document.createRange(),sel=this.getSelection();return range.setStart(node,position),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range),range}_onBeforeUnload(e){if(!this.skipExitTrap&&this.editMode)return"Are you sure you want to leave? Your work will not be saved!"}isBase64(str){try{return btoa(atob(str))==str}catch(err){return!1}}retrieveImageFromClipboardAsBlob(pasteEvent,callback){if(0==pasteEvent.clipboardData&&"function"==typeof callback)return callback(void 0);var items=pasteEvent.clipboardData.items;if(null==items&&"function"==typeof callback)return callback(void 0);for(var i=0;i<items.length;i++)if(-1!=items[i].type.indexOf("image")){var blob=items[i].getAsFile();if("function"==typeof callback)return callback(blob)}}_onPaste(e){if(this.editMode&&"HAX-TRAY"!==document.activeElement.tagName&&"BODY"!==document.activeElement.tagName&&"SIMPLE-MODAL"!==document.activeElement.tagName){this.isTextElement(this.activeNode)||(this.activeNode=this.activeHaxBody.haxInsert("p","",{}));let pasteContent="",originalContent="";if(e.clipboardData||e.originalEvent.clipboardData?(pasteContent=(e.originalEvent||e).clipboardData.getData("text/html"),""==pasteContent&&(pasteContent=(e.originalEvent||e).clipboardData.getData("text"))):window.clipboardData&&(pasteContent=window.clipboardData.getData("Text")),originalContent=pasteContent,this.isBase64(originalContent))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.retrieveImageFromClipboardAsBlob(e,imageBlob=>{if(imageBlob){var URLObj=window.URL||window.webkitURL;let img=document.createElement("img");for(var i in img.src=URLObj.createObjectURL(imageBlob),this.activeNode.parentNode.insertBefore(img,this.activeNode.nextElementSibling),e.clipboardData.items)!e.clipboardData.items[i].name&&e.clipboardData.items[i].type&&(e.clipboardData.items[i].name="image-"+Math.floor(Date.now()/1e3)+e.clipboardData.items[i].type.replace("image/","."));return e.dataTransfer=e.clipboardData,e.placeHolderElement=img,this.dispatchEvent(new CustomEvent("place-holder-file-drop",{bubbles:!0,cancelable:!0,composed:!0,detail:e})),img}return!1});if(e.clipboardData.files.length>0){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let p=this.activeHaxBody.haxInsert("p","",{});for(var i in e.dataTransfer=e.clipboardData,e.clipboardData.files)!e.clipboardData.files[i].name&&e.clipboardData.files[i].type&&(e.clipboardData.files[i].name="image-"+Math.floor(Date.now()/1e3)+e.clipboardData.files[i].type.replace("image/","."));e.placeHolderElement=p,this.dispatchEvent(new CustomEvent("place-holder-file-drop",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}let inlinePaste=!1,newContent="";pasteContent=pasteContent.replace(/<span>\s*?<\/span>/g," "),pasteContent=pasteContent.replace(/<div/g,"<p"),pasteContent=pasteContent.replace(/<\/div>/g,"</p>"),pasteContent=stripMSWord(pasteContent);let haxElements=this.htmlToHaxElements(pasteContent);if(0===haxElements.length&&validURL(pasteContent)){if(""!=this.activeNode.innerText.trim())return!1;let values={source:pasteContent,title:pasteContent};if(!this.insertLogicFromValues(values,this))return!1}else if(0===haxElements.length){if(inlinePaste=!0,originalContent==pasteContent)return!1;newContent=pasteContent}else if(1===haxElements.length&&"p"===haxElements[0].tag)newContent=pasteContent,inlinePaste=!0;else if(1===haxElements.length&&"a"===haxElements[0].tag&&haxElements[0].properties.href)if(""!=this.activeNode.innerText.trim())newContent=haxElements[0].properties.href,inlinePaste=!0;else{let values={source:haxElements[0].properties.href,title:haxElements[0].content};if(!this.insertLogicFromValues(values,this))return!1}else{if(!this.isGridPlateElement(haxElements[0]))return!1;for(var i in haxElements){"p"==haxElements[i].tag&&["li","ol","ul"].includes(this.activeNode.tagName.toLowerCase())&&(haxElements[i].tag="li"),delete haxElements[i].properties.style,delete haxElements[i].properties.start,delete haxElements[i].properties.align;let node=haxElementToNode({tag:haxElements[i].tag,content:haxElements[i].content.replace(/<span>&nbsp;<\/span>/g," ").trim(),properties:haxElements[i].properties});newContent+=this.nodeToContent(node)}}e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();try{let range=this.getRange(),sel=this.getSelection(),newNodes=document.createElement("div");if(newNodes.innerHTML=newContent,range&&sel){for(var i in newNodes.children)newNodes.children[i].tagName&&this.isTextElement(newNodes.children[i])&&""===newNodes.children[i].innerHTML&&newNodes.children[i].remove();if(inlinePaste){let txt=document.createTextNode(newNodes.innerHTML);range.insertNode(txt),setTimeout(()=>{this._positionCursorInNode(txt,txt.length)},0)}else{var _enterSplit,activeEl,siblingEl;for(""!=this.activeNode.innerText.trim()&&range.endOffset!=this.activeNode.innerText.length&&(_enterSplit=!0,document.execCommand("insertParagraph")),range.commonAncestorContainer&&range.commonAncestorContainer.parentNode&&(siblingEl||this.activeNode==range.commonAncestorContainer||(siblingEl=range.commonAncestorContainer.parentNode)||(siblingEl=range.commonAncestorContainer));newNodes.firstElementChild;)activeEl=newNodes.firstElementChild,siblingEl?(siblingEl.getAttribute&&siblingEl.getAttribute("slot")&&activeEl.setAttribute("slot",siblingEl.getAttribute("slot")),_enterSplit?(this.activeHaxBody.haxReplaceNode(siblingEl.previousElementSibling,activeEl),_enterSplit=!1):siblingEl.parentNode.insertBefore(activeEl,siblingEl.nextElementSibling)):this.activeNode?(this.activeNode.getAttribute("slot")&&activeEl.setAttribute("slot",this.activeNode.getAttribute("slot")),""==this.activeNode.innerText.trim()?this.activeHaxBody.haxReplaceNode(this.activeNode,activeEl):this.activeNode.parentNode.insertBefore(activeEl,this.activeNode.nextElementSibling)):this.activeHaxBody.appendChild(activeEl),siblingEl=activeEl;setTimeout(()=>{activeEl&&activeEl.childNodes&&activeEl.childNodes[0]&&(this._positionCursorInNode(activeEl.childNodes[0],activeEl.childNodes[0].length),activeEl=null,siblingEl=null)},0)}}}catch(e){console.warn(e)}}}__validGridTags(){return["p","ol","ul","li","div","h1","h2","h3","h4","h5","h6","blockquote","code","figure"]}__validTags(){return["p","div","span","table","caption","sup","sub","u","strike","tr","th","td","ol","ul","li","a","strong","kbd","tt","em","i","b","hr","h1","h2","h3","h4","h5","h6","blockquote","code","figure","img","iframe","video","audio","section","grid-plate","template","webview"]}__validGizmoTypes(){return["data","video","audio","text","link","file","pdf","image","csv","doc","archive","markdown","html","wikipedia","content","text","inline","*"]}constructor(){super(),this.method="GET",this.haxSelectedText="",this.__winEvents={"hax-register-properties":"_haxStoreRegisterProperties","hax-consent-tap":"_haxConsentTap","hax-context-item-selected":"_haxContextOperation",onbeforeunload:"_onBeforeUnload",paste:"_onPaste","hax-register-app":"_haxStoreRegisterApp","hax-register-stax":"_haxStoreRegisterStax","hax-store-write":"_writeHaxStore","hax-register-core-piece":"_haxStorePieceRegistrationManager","hax-register-body":"_haxStoreRegisterBody","hax-insert-content":"_haxStoreInsertContent","hax-insert-content-array":"_haxStoreInsertMultiple","hax-add-voice-command":"_addVoiceCommand"},window.onbeforeunload=e=>{if(!this.skipExitTrap&&this.editMode){var saving="Are you sure you want to leave? Your work will not be saved!";return e.returnValue=saving,saving}},SimpleTourManager.registerNewTour({key:"hax",name:"Let's learn HAX",style:"\n      simple-popover-manager::part(simple-popover) {\n        max-width: 250px;\n      }\n      simple-popover-manager button {\n        font-size: 12px;\n        margin: 0px 2px;\n      }\n      simple-popover-manager p {\n        --hax-base-styles-p-font-size: 14px;\n        padding: 0;\n        margin: 0;\n        font-size: 14px;\n        line-height: 20px;\n      }\n      simple-popover-manager h3 {\n        --hax-base-styles-h3-font-size: 18px;\n        margin: 8px 2px;\n      }"}),this.voiceRespondsTo="(worker)",this.voiceCommands={},this.skipHAXConfirmation=!1,this.storageData={},this.appStore={url:"",params:{}},this.activeNode=null,this.activeEditingElement=null,this.haxBodies=[],this.activePlaceHolder=null,this.sessionObject={},this.editMode=!1,this.skipExitTrap=!1,this.elementList={},this.appList=[],this.gizmoList=[],this.activeHaxBody=null,this.staxList=[],this.globalPreferences={},this.activeApp={},this.connectionRewrites={},this.voiceDebug=!1,this.keyboardShortcuts={"#":{tag:"h2",content:""},"##":{tag:"h3",content:""},"###":{tag:"h4",content:""},"####":{tag:"h5",content:""},"#####":{tag:"h6",content:""},"-":{tag:"ul",content:"<li></li>"},"1.":{tag:"ol",content:"<li></li>"},"---":{tag:"hr"},"```":{tag:"code",content:""},">":{tag:"blockquote",content:""}},this.validTagList=this.__validTags(),this.validGridTagList=this.__validGridTags(),this.validGizmoTypes=this.__validGizmoTypes();let test=document.createElement("webview");this._isSandboxed="function"==typeof test.reload,import("./hax-app.js"),import("../../simple-toast/simple-toast.js").then(()=>{window.SimpleToast.requestAvailability()}),import("../../media-behaviors/media-behaviors.js"),document.body.style.setProperty("--hax-ui-headings","#d4ff77"),makeObservable(this,{gizmoList:observable,activeNode:observable,globalPreferences:observable,activeGizmo:computed,editMode:observable,appList:observable,activeApp:observable,haxSelectedText:observable,activeEditingElement:observable,activeHaxBody:observable}),autorun(()=>{this._globalPreferencesChanged(toJS(this.globalPreferences))}),autorun(()=>{this._editModeChanged(toJS(this.editMode))})}_buildPrimitiveDefinitions(){if(this._isSandboxed){let webview={type:"element",editingElement:"core",canScale:!0,canPosition:!0,canEditSource:!0,settings:{configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],advanced:[]}};this.setHaxProperties(webview,"webview")}this.setHaxProperties({type:"element",editingElement:"core",canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Basic iframe",description:"A basic iframe",icon:"icons:fullscreen",color:"blue-grey",groups:["Content"],handles:[{type:"link",source:"src",height:"height",width:"width"},{type:"pdf",source:"src",height:"height",width:"width"},{type:"document",source:"src",height:"height",width:"width"},{type:"html",source:"src",height:"height",width:"width"}],meta:{author:"W3C"}},settings:{configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],advanced:[{attribute:"loading",title:"Loading method",description:"Whether or not to lazy load this",inputMethod:"select",options:{lazy:"Load when visible",auto:"Automatic"}}]}},"iframe");this.setHaxProperties({canScale:{min:10,step:5},type:"element",editingElement:"core",canPosition:!0,canEditSource:!0,gizmo:{title:"Image",description:"A basic img tag",icon:"image:image",color:"blue-grey",groups:["Image","Media"],handles:[{type:"link",source:"src"},{type:"image",type_exclusive:!0,source:"src",height:"height",width:"width"}],meta:{author:"W3C"}},settings:{configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"haxupload",icon:"link",required:!0,validationType:"url"},{attribute:"alt",title:"Alt text",description:"Useful for screen readers and improved SEO.",inputMethod:"alt",icon:"accessibility"},{attribute:"height",title:"Height",description:"height in pixels of the item. Leave blank to respond to the natural resolution",inputMethod:"textfield",icon:"icons:swap-vert"}],advanced:[{attribute:"aria-describedby",title:"Aria-describedby",description:"Space-separated list of IDs for elements that describe the image.",inputMethod:"textfield",icon:"accessibility"},{attribute:"loading",title:"Loading method",description:"Whether or not to lazy load this",inputMethod:"select",options:{lazy:"Load when visible",auto:"Automatic"}}]}},"img");let ahref={type:"element",editingElement:"core",canScale:!1,canPosition:!1,canEditSource:!0,contentEditable:!0,gizmo:{title:"Basic link",description:"A basic a tag",icon:"icons:link",color:"blue-grey",groups:["Link"],handles:[],meta:{author:"W3C"}},settings:{configure:[{attribute:"innerText",title:"Text",description:"Text of the link",inputMethod:"textfield",required:!0},{attribute:"href",title:"Link",description:"The URL for this video.",inputMethod:"haxupload",icon:"icons:link",required:!0,validationType:"url"},{attribute:"title",title:"Title text",description:"Useful for screen readers and improved SEO.",inputMethod:"textfield",icon:"icons:accessibility"},{attribute:"target",title:"Target",description:"Where to place the link.",inputMethod:"select",icon:"icons:launch",options:{"":"Same window",_blank:"New window",_top:"Top window",_parent:"Parent window"}}],advanced:[]}};this.validGizmoTypes.forEach(val=>{ahref.gizmo.handles.push({type:val,source:"href",title:"innerText",alt:"title"})}),this.setHaxProperties(ahref,"a");this.setHaxProperties({type:"element",editingElement:"core",canScale:!1,canPosition:!1,canEditSource:!0,contentEditable:!0,gizmo:{title:"Paragraph",description:"A basic text area",icon:"hax:paragraph",color:"blue-grey",groups:["Content"],handles:[{type:"content",content:""}],meta:{author:"W3C"}},settings:{configure:[],advanced:[]},demoSchema:[{tag:"p",content:"Text",properties:{}}]},"p");this.setHaxProperties({type:"element",editingElement:{tag:"editable-table",import:"@lrnwebcomponents/editable-table/editable-table.js"},canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Table",description:"A table for displaying data",icon:"image:grid-on",color:"blue-grey",groups:["Content","Table","Data"],meta:{author:"W3C"}},settings:{configure:[],advanced:[]},demoSchema:[{tag:"table",content:"<tr><td>-</td><td>-</td><td>-</td></tr><tr><td>-</td><td>-</td><td>-</td></tr><tr><td>-</td><td>-</td><td>-</td></tr>",properties:{}}]},"table");let prims={caption:{title:"Caption",icon:"av:call-to-action"},video:{title:"Video",icon:"av:play-circle-filled"},audio:{title:"Audio",icon:"image:music-note"},section:{title:"Section",icon:"image:crop-landscape"},ol:{title:"Numbered list",icon:"editor:format-list-numbered"},ul:{title:"Bulleted list",icon:"editor:format-list-bulleted"},li:{title:"List item",icon:"editor:format-list-bulleted"},h1:{title:"Heading",icon:"hax:h1"},h2:{title:"Heading",icon:"hax:h2"},h3:{title:"Heading",icon:"hax:h3"},h4:{title:"Heading",icon:"hax:h4"},h5:{title:"Heading",icon:"hax:h5"},h6:{title:"Heading",icon:"hax:h6"},strike:{title:"Cross out",icon:"editor:format-strikethrough"},u:{title:"Underline",icon:"editor:format-underlined"},sub:{title:"Subscript",icon:"mdextra:subscript"},sup:{title:"Superscript",icon:"mdextra:superscript"},div:{title:"DIV",icon:"image:crop-landscape"},span:{title:"SPAN",icon:"editor:short-text"},i:{title:"Italic",icon:"editor:format-italic"},em:{title:"Emphasis",icon:"editor:format-italic"},strong:{title:"Bold",icon:"editor:format-bold"},b:{title:"Bold",icon:"editor:format-bold"},blockquote:{title:"Block quote",icon:"editor:format-quote"},code:{title:"Code",icon:"icons:code"},figure:{title:"Figure",icon:"icons:label-outline"},embed:{title:"Embedded object",icon:"icons:fullscreen"}};for(var tag in prims)this.setHaxProperties({type:"element",editingElement:"core",canScale:!1,canPosition:!1,canEditSource:!0,contentEditable:!0,gizmo:{title:prims[tag].title,icon:prims[tag].icon,meta:{hidden:"h2"!=tag}},settings:{configure:[],advanced:[]},demoSchema:[{tag,content:"h2"==tag?"Heading":"",properties:{}}]},tag);this.setHaxProperties({canScale:{min:25,step:25},type:"element",editingElement:"core",canPosition:!1,canEditSource:!1,contentEditable:!0,gizmo:{title:"Horizontal line",icon:"hax:hr",meta:{author:"W3C"}},settings:{configure:[],advanced:[]},demoSchema:[{tag:"hr",content:"",properties:{style:"width:50%;"}}]},"hr")}_haxStorePieceRegistrationManager(e){e.detail&&e.detail.piece&&e.detail.object&&(this[e.detail.piece]=e.detail.object)}setupAutocomplete(editor){editor.triggers={"!":el=>{let triggers=[];return this.gizmoList.forEach(item=>{triggers.push({groups:item.groups&&item.groups.length?item.groups.join(" "):"",icon:item.icon,label:item.title,value:item.tag})}),triggers}}}_haxStoreInsertContent(e){if(e.detail){let details=e.detail;if(window.customElements.get(details.tag)){let prototypeNode=document.createElement(details.tag);this.testHook(prototypeNode,"preProcessInsertContent")&&(details=this.runHook(prototypeNode,"preProcessInsertContent",[details]))}var properties={};if(void 0!==details.properties&&(properties=details.properties),properties.innerHTML&&(""==details.content&&(details.content=properties.innerHTML),delete properties.innerHTML),properties.innerText&&(""==details.content&&(details.content=properties.innerText),delete properties.innerText),void 0!==details.__type&&"inline"===details.__type){let node=haxElementToNode({tag:details.tag,content:details.content,properties});null!==this.activePlaceHolder&&(this.activePlaceHolder.deleteContents(),this.activePlaceHolder.insertNode(node)),this.activePlaceHolder=null}else if(details.replace||details.replacement||details.nextToActive){let node=haxElementToNode({tag:details.tag,content:details.content,properties});this.activePlaceHolder?(this.activeHaxBody.haxReplaceNode(this.activePlaceHolder,node),this.activePlaceHolder=null):details.nextToActive&&this.activeNode?this.activeHaxBody.__slot&&"GRID-PLATE"===this.activeNode.tagName?this.activeNode.appendChild(node):this.activeNode.parentNode.insertBefore(node,this.activeNode):this.activeHaxBody.haxReplaceNode(this.activeNode,node)}else if(this.activeNode.parentNode&&"HAX-BODY"!=this.activeNode.parentNode.tagName){let node=haxElementToNode({tag:details.tag,content:details.content,properties});"GRID-PLATE"===this.activeNode.parentNode.tagName?(null!=this.activeNode.getAttribute("slot")&&node.setAttribute("slot",this.activeNode.getAttribute("slot")),this.activeHaxBody.haxInsert(details.tag,details.content,properties)):this.activeHaxBody.haxInsert(details.tag,details.content,properties)}else this.activeHaxBody.haxInsert(details.tag,details.content,properties)}}haxSchemaFromTag(tag){return tag=tag.toLowerCase(),this.elementList&&this.elementList[tag]?this.elementList[tag]:{}}_haxStoreInsertMultiple(e){var properties;if(e.detail)for(var i in e.detail)properties={},void 0!==e.detail[i].properties&&(properties=e.detail[i].properties),this.activeHaxBody.haxInsert(e.detail[i].tag,e.detail[i].content,properties)}_haxStoreRegisterBody(e){e.detail&&(this.haxBodies.push(e.detail),this.activeHaxBody=e.detail,this.write("activeHaxBody",this.activeHaxBody,this),this.write("editMode",this.editMode,this))}computePolyfillSafe(){return!(!document.head.createShadowRoot&&!document.head.attachShadow)||(console.warn("Shadow DOM missing, certain operations hidden"),!1)}_writeHaxStore(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&e.detail.owner&&(e.detail.owner!==this&&(null==e.detail.value?this[e.detail.property]=null:"object"==typeof e.detail.value&&(this[e.detail.property]={}),this[e.detail.property]=e.detail.value),this.dispatchEvent(new CustomEvent("hax-store-property-updated",{bubbles:!0,composed:!0,cancelable:!1,detail:{property:e.detail.property,value:e.detail.value,owner:e.detail.owner}})))}_haxStoreRegisterApp(e){if(e.detail){if(e.detail.index=this.appList.length,this.appList=[...this.appList,e.detail],this.write("appList",this.appList,this),e.detail.connection&&e.detail.connection.protocol&&e.detail.connection.url){let preconnectlink=document.createElement("link");preconnectlink.rel="preconnect",preconnectlink.href=e.detail.connection.protocol+"://"+e.detail.connection.url,document.head.appendChild(preconnectlink)}void 0!==e.target.parentElement&&"HAX-STORE"===e.target.parentElement.tagName&&e.target.parentElement.removeChild(e.target)}}_haxStoreRegisterStax(e){e.detail&&(e.detail.index=this.staxList.length,this.staxList=[...this.staxList,e.detail],this.write("staxList",this.staxList,this),void 0!==e.target.parentElement&&"HAX-STORE"===e.target.parentElement.tagName&&e.target.parentElement.removeChild(e.target))}dashToCamel(str){return str.replace(/-([a-z])/g,(function(g){return g[1].toUpperCase()}))}htmlToHaxElements(html){let elements=[];const validTags=this.validTagList;let fragment=document.createElement("div");fragment.innerHTML=html;const children=fragment.childNodes;for(var i=0;i<children.length;i++)void 0!==children[i].tagName&&validTags.includes(children[i].tagName.toLowerCase())&&elements.push(nodeToHaxElement(children[i],null));return elements}nodeToContent(node){this.testHook(node,"preProcessNodeToContent")&&(node=this.runHook(node,"preProcessNodeToContent",[node]));let tag=node.tagName.toLowerCase();this._isSandboxed&&"webview"===tag&&(tag="iframe");var content="";content+="<"+tag;for(var props=this.elementList[tag],propvals={},j=0,l=node.attributes.length;j<l;++j){var nodeName=node.attributes.item(j).nodeName,value=node.attributes.item(j).value;"style"==nodeName||typeof value!=typeof Object&&value.constructor!==Array?null!=value&&"null"!=value&&(!0===value||"true"===value?propvals[nodeName]=!0:!1===value||("string"==typeof value&&""!==value?(value=value.replace(new RegExp('"',"g"),"&quot;"),propvals[nodeName]=value):""===value?(""==value&&""!=node.attributes.item(j).value&&(value=node.attributes.item(j).value),propvals[nodeName]=value):propvals[nodeName]=value)):propvals[nodeName]=JSON.stringify(value).replace(new RegExp('"',"g"),"&quot;")}let tmpProps;if(customElements.get(tag)&&(tmpProps=customElements.get(tag).properties),void 0===tmpProps&&(tmpProps=node.__data),void 0!==tmpProps)for(var j in tmpProps){nodeName=camelToDash(j),value=null;void 0!==node[j]&&(value=node[j]),tmpProps[j].readOnly||tmpProps[j].computed||value===tmpProps[j].value||nodeName.startsWith("__")||(null==value||"object"!=typeof value&&value.constructor!==Array?null!=value&&"null"!=value&&(!0===value||"true"===value?propvals[nodeName]=!0:!1===value||("string"==typeof value&&""!==value?(value=value.replace(new RegExp('"',"g"),"&quot;"),propvals[nodeName]=value):""===value?""==value&&""!=tmpProps[j].value?value=tmpProps[j].value:""===value&&tmpProps[j].value:propvals[nodeName]=value)):(value.constructor===Array&&value!=[]||"object"==typeof value&&value!={})&&(propvals[nodeName]=JSON.stringify(value).replace(new RegExp('"',"g"),"&quot;")))}if(void 0!==props&&void 0!==props.saveOptions.unsetAttributes)for(var i in props.saveOptions.unsetAttributes)delete propvals[props.saveOptions.unsetAttributes[i]];let delProps=["inner-text","inner-html","tabindex","guestinstance"];for(var delProp in delProps)void 0!==propvals[delProps[delProp]]&&delete propvals[delProps[delProp]];for(var i in void 0!==propvals.id&&""===propvals.id&&delete propvals.id,delete propvals.draggable,delete propvals.contenteditable,delete propvals["data-hax-ray"],""!=propvals.class&&"hax-active"!=propvals.class||delete propvals.class,propvals)!0===propvals[i]?content+=" "+i:content+=" "+i+'="'+propvals[i]+'"';if(["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].includes(tag)?content+="/>":content+=">",void 0===props||!props.saveOptions.wipeSlot){let slotnodes=node.childNodes;if(slotnodes.length>0){j=0;for(var len2=slotnodes.length;j<len2;j++)void 0!==slotnodes[j].tagName?this.HTMLPrimativeTest(slotnodes[j].tagName)||"TEMPLATE"===slotnodes[j].tagName?(slotnodes[j].removeAttribute("data-hax-ray"),slotnodes[j].contentEditable=!1,content+=slotnodes[j].outerHTML):content+=this.nodeToContent(slotnodes[j]):8===slotnodes[j].nodeType?content+="\x3c!-- "+slotnodes[j].textContent+" --\x3e":1!==slotnodes[j].nodeType&&void 0!==slotnodes[j].textContent&&"undefined"!==slotnodes[j].textContent&&(content+=slotnodes[j].textContent)}}return this.testHook(node,"progressiveEnhancement")&&(content+=this.runHook(node,"progressiveEnhancement",[node])),"span"===tag?content+="</"+tag+">":"hr"===tag||"br"===tag||"img"===tag||(content+="</"+tag+">\n"),content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=(content=content.replace(/&nbsp;/gm," ")).replace(/ data-hax-ray="(\s|.)*?"/gim,"")).replace(/ class=""/gim,"")).replace(/ class="hax-active"/gim,"")).replace(/ contenteditable="(\s|.)*?"/gim,"")).replace(/<span style="(.*?)">/gim,"<span>")).replace(/<span>\s*?<\/span>/g," ")).replace(/<span><br\/><\/span>/gm,"")).replace(/<strong style="(.*?)">/gim,"<strong>")).replace(/<b style="(.*?)">/gim,"<b>")).replace(/<strike style="(.*?)">/gim,"<strike>")).replace(/<em style="(.*?)">/gim,"<em>")).replace(/<i style="(.*?)">/gim,"<i>")).replace(/<p>(\s*)<\/p>/gm,"<p></p>")).replace(/<p>&nbsp;<\/p>/gm,"<p></p>")).replace(/<p><br\/><\/p>/gm,"<p></p>")).replace(/<p><br><\/p>/gm,"<p></p>")).replace(/<\/p>(\s*)<p>/gm,"</p><p>")).split("\n\r").join("\n").split("\r").join("\n").split("\n\n").join("\n").split("\n\n").join("\n").split("\n\n").join("\n"),this.testHook(node,"postProcessNodeToContent")&&(content=this.runHook(node,"postProcessNodeToContent",[content])),content}HTMLPrimativeTest(node){return void 0!==node.tagName&&-1==node.tagName.indexOf("-")}getHaxAppStoreTargets(type){return this.appList.filter(app=>{if(void 0!==app.connection.operations.add){let add=app.connection.operations.add;if(void 0!==add.acceptsGizmoTypes&&add.acceptsGizmoTypes.includes(type))return!0}return!1})}refreshActiveNodeForm(){this.haxTray.activeHaxElement=nodeToHaxElement(this.haxTray.activeNode,null),this.haxTray._setupForm()}haxElementPrototype(gizmo,properties,content=""){return{tag:gizmo.tag,properties,content,gizmo}}getHAXSlot(node){if(this.isTextElement(node))return node.innerHTML;let content="";var slotnodes=node.childNodes;if(slotnodes.length>0)for(var j=0,len2=slotnodes.length;j<len2;j++)void 0!==slotnodes[j].tagName?slotnodes[j].tagName.indexOf("-")>0?content+="  "+this.nodeToContent(slotnodes[j])+"\n":content+="  "+slotnodes[j].outerHTML+"\n":8===slotnodes[j].nodeType?content+="\x3c!-- "+slotnodes[j].textContent+" --\x3e":1!==slotnodes[j].nodeType&&void 0!==slotnodes[j].textContent&&"undefined"!==slotnodes[j].textContent&&(content+=slotnodes[j].textContent);return content}_haxStoreRegisterProperties(e){if(e.detail&&e.detail.properties&&e.detail.tag){if(!this.elementList[e.detail.tag]){let gizmo=e.detail.properties.gizmo;if(gizmo){gizmo.tag=e.detail.tag;let gizmos=this.gizmoList;gizmos.push(gizmo),this.gizmoList=[...gizmos],this.write("gizmoList",gizmos,this),window.customElements.get(gizmo.tag)&&this.testHook(document.createElement(gizmo.tag),"gizmoRegistration")&&this.runHook(document.createElement(gizmo.tag),"gizmoRegistration",[this])}this.elementList[e.detail.tag]=e.detail.properties,this.validTagList.find(element=>element===e.detail.tag)||this.validTagList.push(e.detail.tag),"grid"!=e.detail.properties.type||this.validGridTagList.find(element=>element===e.detail.tag)||this.validGridTagList.push(e.detail.tag)}void 0!==e.target.parentElement&&"HAX-AUTOLOADER"===e.target.parentElement.tagName&&this.haxAutoloader.removeChild(e.target)}}get activeGizmo(){let gizmo=toJS(this._calculateActiveGizmo(this.activeNode));return this.write("activeGizmo",gizmo,this),gizmo}}window.customElements.define(HaxStore.tag,HaxStore);export{HaxStore};window.HaxStore=window.HaxStore||{},window.HaxStore.requestAvailability=function(){return window.HaxStore.instance||(window.HaxStore.instance=document.createElement("hax-store"),document.body.appendChild(window.HaxStore.instance)),window.HaxStore.instance};export const HAXStore=window.HaxStore.requestAvailability();window.Hax=window.Hax||{},window.Hax.add=function(tag){if(HAXStore.elementList[tag]){let target,schema=HAXStore.haxSchemaFromTag(tag);target=schema.gizmo.tag&&schema.demoSchema&&schema.demoSchema[0]?haxElementToNode(schema.demoSchema[0]):document.createElement(tag),HAXStore.activeHaxBody.haxReplaceNode(HAXStore.activeNode,target),HAXStore.activeHaxBody.__focusLogic(target)}else HAXStore.toast(`${tag} is not a valid tag`)},window.Hax.delete=function(){null!=HAXStore.activeNode&&HAXStore.activeHaxBody.haxDeleteNode(HAXStore.activeNode)},window.Hax.duplicate=function(){HAXStore.activeHaxBody.haxDuplicateNode(HAXStore.activeNode)},window.Hax.move=function(dir=!0){dir?HAXStore.activeHaxBody.haxMoveGridPlate("up",HAXStore.activeNode):HAXStore.activeHaxBody.haxMoveGridPlate("down",HAXStore.activeNode)},window.Hax.grid=function(op=!0){HAXStore.activeHaxBody.haxGridPlateOps(op)},window.Hax.set=function(key,value){HAXStore.write(key,value,window)},window.Hax.get=function(key){return HAXStore[key]},window.Hax.export=function(){return HAXStore.activeHaxBody.haxToContent()},window.Hax.import=function(htmlContent="<p></p>"){return HAXStore.activeHaxBody.importContent(htmlContent)};