/**
 * Copyright 2019 Penn State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement,html,css}from"../../../../lit-element/lit-element.js";import{RichTextEditorButtonStyles}from"./rich-text-editor-button-styles.js";import"../singletons/rich-text-editor-selection.js";import"../../../simple-icon/lib/simple-icon-lite.js";import"../../../simple-icon/lib/simple-icons.js";import"../../../simple-icon/lib/simple-icon-button-lite.js";import"../../../hax-iconset/lib/simple-hax-iconset.js";const RichTextEditorButtonBehaviors=function(SuperClass){return class extends(RichTextEditorButtonStyles(SuperClass)){firstUpdated(changedProperties){super.firstUpdated&&super.firstUpdated(changedProperties),this.__a11y=this.shadowRoot.querySelector("#button"),this.__a11y.addEventListener("keypress",e=>{switch(e.key){case"Enter":this._buttonTap(e)}})}static get tag(){return"rich-text-editor-button"}static get styles(){return[...super.styles,css`
          .rtebutton {
            min-width: var(--rich-text-editor-button-min-width);
            height: var(--rich-text-editor-button-height);
            margin: var(--rich-text-editor-button-margin);
            padding: var(--rich-text-editor-button-padding);
          }
        `]}render(){return html`
        <button
          id="button"
          class="rtebutton"
          ?disabled="${this.disabled}"
          ?controls="${this.controls}"
          @click="${this._buttonTap}"
          tabindex="0"
          ?toggled="${this.isToggled}"
        >
          <simple-icon-lite
            id="icon"
            aria-hidden="true"
            icon="${this.currentIcon}"
          >
          </simple-icon-lite>
          <span id="label" class="${this.labelStyle}"
            >${this.currentLabel}</span
          >
        </button>
        <simple-tooltip id="tooltip" for="button"
          >${this.currentLabel}</simple-tooltip
        >
      `}static get properties(){return{controls:{type:String},command:{type:String},commandVal:{attribute:"command-val",type:Object},disabled:{type:Boolean},icon:{type:String},label:{type:String},range:{type:Object},shortcutKeys:{attribute:"shortcut-keys",type:String},showTextLabel:{attribute:"show-text-label",type:Boolean},tag:{type:String},target:{type:Object},toggledCommand:{attribute:"toggled-command",type:String},toggledCommandVal:{attribute:"toggled-command-val",type:Object},toggledIcon:{attribute:"toggled-icon",type:String},toggledLabel:{attribute:"toggled-label",type:String},selectedNode:{type:Object},selectionAncestors:{type:Array},toggles:{type:Boolean},__selection:{type:Object}}}constructor(){super(),this.__selection=window.RichTextEditorSelection.requestAvailability(),this.disabled=!1,this.showTextLabel=!1,this.toggles=!1,import("../../../simple-tooltip/simple-tooltip.js")}get blockSelectors(){return"p,h1,h2,h3,h4,h5,h6,div,address,blockquote,pre"}get currentLabel(){return this._regOrToggled(this.label,this.toggledLabel,this.isToggled)}get currentIcon(){return this._regOrToggled(this.icon,this.toggledIcon,this.isToggled)}get labelStyle(){return this.icon&&""!==this.icon&&!1===this.showTextLabel?"offscreen":null}get isToggled(){let command=!(!this.range||!this.command)&&document.queryCommandState(this.command),block="underline"===this.command?!!this.rangeQuery("u"):command;return!(!this.toggles||!block)}get validCommands(){return["backColor","bold","createLink","copy","cut","defaultParagraphSeparator","delete","fontName","fontSize","foreColor","formatBlock","forwardDelete","insertHorizontalRule","insertHTML","insertImage","insertLineBreak","insertOrderedList","insertParagraph","insertText","insertUnorderedList","justifyCenter","justifyFull","justifyLeft","justifyRight","outdent","paste","redo","selectAll","strikethrough","styleWithCss","superscript","undo","unlink","useCSS"]}updated(changedProperties){super.updated(changedProperties),changedProperties.forEach((oldValue,propName)=>{"controls"===propName&&this._editorChanged(this.controls,oldValue),"range"===propName&&this._rangeChanged(this.range,oldValue)})}disconnectedCallback(){super.disconnectedCallback()}get operationCommand(){return this.isToggled&&this.toggledCommand?this.toggledCommand:this.command}get operationCommandVal(){return this.isToggled&&this.toggledCommand?this.toggledCommandVal||"":this.commandVal}highlight(on=!0){this.dispatchEvent(new CustomEvent("highlight",{bubbles:!0,composed:!0,cancelable:!0,detail:on}))}highlightNode(node){this.dispatchEvent(new CustomEvent("highlightnode",{bubbles:!0,composed:!0,cancelable:!0,detail:node}))}selectRange(range){this.dispatchEvent(new CustomEvent("selectrange",{bubbles:!0,composed:!0,cancelable:!0,detail:range}))}selectNode(node){this.dispatchEvent(new CustomEvent("selectnode",{bubbles:!0,composed:!0,cancelable:!0,detail:node}))}selectNodeContents(node){this.dispatchEvent(new CustomEvent("selectnodeccontents",{bubbles:!0,composed:!0,cancelable:!0,detail:node}))}wrapSelection(element){this.dispatchEvent(new CustomEvent("wrapselection",{bubbles:!0,composed:!0,cancelable:!0,detail:element}))}startNode(){let startContainer=this.range?this.range.startContainer:void 0,startOffset=this.range?this.range.startOffset:void 0;return startContainer?startContainer.children?startContainer.children[startOffset-1]:startContainer.childNodes?startContainer.childNodes[startOffset-1]:void 0:void 0}rangeElement(){return this.rangeIsElement()?this.startNode():this.rangeParent()}rangeIsElement(){let startContainer=this.range?this.range.startContainer:void 0,startOffset=this.range?this.range.startOffset:void 0,endContainer=this.range?this.range.endContainer:void 0,endOffset=this.range?this.range.endOffset:void 0;return startContainer===endContainer&&endOffset-startOffset==1}rangeParent(){let common=this.range?this.range.commonAncestorContainer:void 0;return common?1==common.nodeType?common:common.parentElement:void 0}rangeQuery(selectors=this.blockSelectors||this.tag){selectors=selectors.toLowerCase().replace(/\s*/g,"");let start=this.rangeElement(),startTag=start&&start.tagName?start.tagName.toLowerCase():void 0,tags=selectors.split(",");return start?startTag&&tags.includes(startTag)?start:start.closest(selectors):void 0}sendCommand(command=this.operationCommand,commandVal=this.operationCommandVal){this.dispatchEvent(new CustomEvent("command",{bubbles:!0,cancelable:!0,composed:!0,detail:{command,commandVal,range:this.range}}))}setRange(){let block=this.rangeQuery();block&&this.selectNode(block)}_buttonTap(e){console.log("_buttonTap",this.range),e.preventDefault(),this.sendCommand()}_editorChanged(newValue,oldValue){}_getSelection(){return"formatBlock"===this.command?this.rangeQuery():this._getSelectedHtml()}_getSelectedHtml(){if(this.range){let val,div=document.createElement("div"),contents=this.range.cloneContents();return div.appendChild(contents),val=div.innerHTML,div.remove(),val?val.trim():void 0}}_getSelectedTag(){let block=this.rangeQuery();return!(!block||!block.tagName)&&block.tagName.toLowerCase()}_getSelectionType(){return"formatBlock"===this.command?this._getSelectedTag():this._getSelectedHtml()}_keysPressed(e){e.preventDefault(),this._buttonTap(e)}_rangeChanged(newVal,oldVal){}_regOrToggled(toggledOff,toggledOn,toggled){return toggledOn&&toggled?toggledOn:toggledOff}}};class RichTextEditorButton extends(RichTextEditorButtonBehaviors(LitElement)){}window.customElements.define(RichTextEditorButton.tag,RichTextEditorButton);export{RichTextEditorButton,RichTextEditorButtonBehaviors};